<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Banking System — Sanket</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background: linear-gradient(180deg,#061028,#081426);
      color:#e8f4ff;
      font-family: 'Poppins', sans-serif;
      padding-top: 2rem;
      transition: background 0.5s, color 0.5s;
    }
    body.light { background: #f9fafc; color:#1c2430; }
    .card { background: rgba(255,255,255,0.06); border:none; border-radius:16px; box-shadow:0 8px 30px rgba(2,6,23,.6); transition:.3s; }
    body.light .card { background:#fff; color:#1c2430; }
    .btn-primary { background: linear-gradient(90deg,#6ee7b7,#60a5fa); border:none; color:#072032; font-weight:600; }
    .btn-primary:hover { transform: translateY(-3px) scale(1.02); }
    .muted { color:#9aa4b2; }
    .history-table { font-size:0.9rem; }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(8px);} to {opacity:1; transform:translateY(0);} }
    .balance-number { font-size:1.5rem; font-weight:700; }
    .mode-toggle { cursor:pointer; }
  </style>
</head>
<body>
  <main class="container" style="max-width:960px">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1><i class="bi bi-bank2"></i> Banking System — Sanket</h1>
      <div class="mode-toggle text-muted"><i class="bi bi-moon-stars-fill"></i> Toggle Mode</div>
    </div>

    <!-- Controls & Balance -->
    <div class="row g-3">
      <div class="col-md-6">
        <div class="card p-3">
          <h5><i class="bi bi-wallet2"></i> Actions</h5>
          <div class="mb-3">
            <label class="form-label">Deposit Amount</label>
            <input id="depositAmt" type="number" class="form-control" placeholder="Enter amount (e.g., 500)">
            <button id="depositBtn" class="btn btn-primary mt-2">Deposit</button>
          </div>
          <div class="mb-3">
            <label class="form-label">Withdraw Amount</label>
            <input id="withdrawAmt" type="number" class="form-control" placeholder="Enter amount (e.g., 200)">
            <button id="withdrawBtn" class="btn btn-outline-light mt-2">Withdraw</button>
          </div>
          <div class="d-flex gap-2">
            <button id="checkBtn" class="btn btn-info text-dark">Check Balance</button>
            <button id="resetBtn" class="btn btn-danger">Reset</button>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card p-3 text-center">
          <h5><i class="bi bi-cash-stack"></i> Current Balance</h5>
          <div id="balanceDisplay" class="balance-number">0</div>
          <small class="muted">Balance persists in your browser</small>
          <div class="mt-3">
            <a href="banking.py" download class="btn btn-sm btn-outline-light">
              <i class="bi bi-download"></i> Download Python Script
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Transaction history -->
    <div class="card p-3 mt-4">
      <h5><i class="bi bi-journal-text"></i> Transaction History</h5>
      <table class="table table-sm table-hover text-light history-table">
        <thead>
          <tr><th>#</th><th>Type</th><th>Amount</th><th>Balance After</th><th>Time</th></tr>
        </thead>
        <tbody id="historyBody"></tbody>
      </table>
    </div>
  </main>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script>
    let pyodide = null;
    let historyCount = 0;

    async function initPy() {
      pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/" });
      const code = `
balance = 0
def check_balance():
    return balance
def cash_withdraw(w_amt):
    global balance
    w_amt = int(w_amt)
    if w_amt <= 0: return "Enter >0"
    if balance < w_amt: return "Insufficient"
    balance -= w_amt
    return f"Withdrew {w_amt}"
def cash_deposit(d_amt):
    global balance
    d_amt = int(d_amt)
    if d_amt <= 0: return "Enter >0"
    balance += d_amt
    return f"Deposited {d_amt}"
`;
      await pyodide.runPythonAsync(code);
      // restore balance
      const stored = localStorage.getItem('balance');
      if(stored) pyodide.runPython(`balance=${stored}`);
      updateBalance();
    }
    initPy();

    function updateBalance(){
      const bal = pyodide.runPython('balance');
      animateBalance(bal);
      localStorage.setItem('balance', bal);
    }

    function animateBalance(newVal){
      const el = document.getElementById('balanceDisplay');
      const oldVal = parseInt(el.textContent) || 0;
      let start = oldVal;
      const step = (newVal - oldVal) / 20;
      let i=0;
      const timer = setInterval(()=>{
        i++;
        start += step;
        el.textContent = Math.round(start);
        if(i>=20){ clearInterval(timer); el.textContent = newVal; }
      },30);
    }

    function addHistory(type, amt){
      historyCount++;
      const bal = pyodide.runPython('balance');
      const row = document.createElement('tr');
      row.classList.add('fade-in');
      row.innerHTML = `<td>${historyCount}</td>
        <td>${type}</td>
        <td>${amt}</td>
        <td>${bal}</td>
        <td>${new Date().toLocaleTimeString()}</td>`;
      document.getElementById('historyBody').prepend(row);
    }

    document.getElementById('depositBtn').addEventListener('click',()=>{
      const amt = parseInt(document.getElementById('depositAmt').value);
      if(!amt || amt<=0){ alert("Enter valid deposit"); return; }
      pyodide.runPython(`cash_deposit(${amt})`);
      updateBalance();
      addHistory("Deposit", amt);
      document.getElementById('depositAmt').value="";
    });

    document.getElementById('withdrawBtn').addEventListener('click',()=>{
      const amt = parseInt(document.getElementById('withdrawAmt').value);
      if(!amt || amt<=0){ alert("Enter valid withdraw"); return; }
      const res = pyodide.runPython(`cash_withdraw(${amt})`);
      if(res=="Insufficient"){ alert("Insufficient Balance"); return; }
      updateBalance();
      addHistory("Withdraw", amt);
      document.getElementById('withdrawAmt').value="";
    });

    document.getElementById('checkBtn').addEventListener('click',()=>{ updateBalance(); });
    document.getElementById('resetBtn').addEventListener('click',()=>{
      pyodide.runPython('balance=0');
      updateBalance();
      addHistory("Reset",0);
    });

    // Dark/light toggle
    document.querySelector('.mode-toggle').addEventListener('click',()=>{
      document.body.classList.toggle('light');
    });
  </script>
</body>
</html>
